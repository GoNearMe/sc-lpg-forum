<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Авторизація...</title>

  <!-- Optional styling -->
  <style>
    body {
      font-family: system-ui, sans-serif;
      text-align: center;
      padding-top: 80px;
      color: #333;
      background: #f6f9fc;
    }
  </style>

  <script type="module">
    import { handleGoogleRedirect } from './js/auth.js';

    window.addEventListener('DOMContentLoaded', async () => {
      try {
        // We don't need to load full usersCache here — it's handled by Firestore later
        const usersCache = [];

        await handleGoogleRedirect(usersCache, (u) => {
          localStorage.setItem('lpg_current_user', JSON.stringify(u));
        });

        // Small delay to ensure storage finishes
        setTimeout(() => {
          window.location.href = '/'; // back to main forum
        }, 500);
      } catch (err) {
        console.error('Login redirect failed:', err);
        document.body.innerHTML = `
          <h2>❌ Помилка авторизації</h2>
          <p>Спробуйте ще раз або поверніться <a href="/">на головну</a>.</p>
        `;
      }
    });
  </script>
</head>
<body>
  <h2>Виконується вхід через Google...</h2>
  <p>Зачекайте кілька секунд...</p>
</body>
</html>
