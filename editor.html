<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Post Editor - Fiend</title>
  <style>
    /* Design tokens from your system */
    :root{
      --bg:#eef6fb; 
      --card:#ffffff; 
      --muted:#6b7682; 
      --accent:#3867d6; 
      --accent-2:#ff9f43;
      --radius:16px; 
      --shadow:0 12px 30px rgba(31,41,55,0.08); 
      --glass:rgba(255,255,255,0.6);
      --anim-fast:220ms; 
      --anim-mid:420ms;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
      background: var(--bg);
      min-height: 100vh;
      padding: 0;
      color: #0b1720;
      position: relative;
      overflow: auto;
    }

    /* Animated background grid */
    .grid-overlay {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none;
      background-image: 
        repeating-linear-gradient(180deg, rgba(56, 103, 214, 0.03) 0 1px, transparent 1px 56px),
        repeating-linear-gradient(90deg, rgba(56, 103, 214, 0.03) 0 1px, transparent 1px 56px);
      animation: moveGrid 30s linear infinite;
      opacity: 0.4;
    }

    @keyframes moveGrid {
      from { background-position: 0 0, 0 0; }
      to { background-position: 1000px 1000px, -1000px -1000px; }
    }

    /* Header with Fiend branding */
    .header {
      background: linear-gradient(135deg, var(--accent), #6ea8ff);
      color: white;
      padding: 16px 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: 0 4px 12px rgba(56, 103, 214, 0.15);
      z-index: 10;
      position: relative;
    }

    .header h1 {
      font-size: 24px;
      font-weight: 700;
      margin: 0;
      text-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .header .user-info {
      display: flex;
      align-items: center;
      gap: 12px;
      font-size: 14px;
      opacity: 0.9;
    }

    .editor-container {
      background: var(--card);
      margin: 20px auto;
      max-width: 1200px;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow: hidden;
      border: 1px solid rgba(56, 103, 214, 0.08);
      z-index: 1;
      position: relative;
      min-height: calc(100vh - 80px);
    }

    /* Word-like toolbar */
    .toolbar {
      background: #f8f9fa;
      border-bottom: 1px solid #dee2e6;
      padding: 0;
    }

    .toolbar-tabs {
      display: flex;
      background: #e9ecef;
      padding: 0 20px;
      border-bottom: 1px solid #dee2e6;
    }

    .toolbar-tab {
      padding: 8px 16px;
      background: transparent;
      border: none;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      color: #495057;
      border-radius: 4px 4px 0 0;
      transition: all var(--anim-fast);
    }

    .toolbar-tab.active {
      background: #f8f9fa;
      color: var(--accent);
      border-bottom: 2px solid var(--accent);
    }

    .toolbar-content {
      padding: 12px 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
      min-height: 60px;
    }

    .toolbar-group {
      display: flex;
      gap: 2px;
      align-items: center;
      padding: 0 8px;
      border-right: 1px solid #dee2e6;
    }

    .toolbar-group:last-child {
      border-right: none;
    }

    .toolbar button {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 6px 10px;
      color: #495057;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      transition: all var(--anim-fast);
      min-width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .toolbar button:hover {
      background: #e9ecef;
      border-color: var(--accent);
      color: var(--accent);
    }

    .toolbar button.active {
      background: var(--accent);
      border-color: var(--accent);
      color: white;
      box-shadow: 0 2px 4px rgba(56, 103, 214, 0.25);
    }

    .toolbar select {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      padding: 6px 10px;
      color: #495057;
      cursor: pointer;
      font-size: 14px;
      transition: all var(--anim-fast);
      font-family: inherit;
      min-width: 120px;
    }

    .toolbar select:hover, .toolbar select:focus {
      border-color: var(--accent);
      outline: none;
    }

    .toolbar input[type="color"] {
      width: 36px;
      height: 36px;
      border: 1px solid #dee2e6;
      border-radius: 4px;
      cursor: pointer;
      background: white;
      transition: all var(--anim-fast);
    }

    /* Document area like Word */
    .document-area {
      background: #f5f5f5;
      padding: 40px 20px;
      min-height: calc(100vh - 200px);
    }

    .document-container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      border-radius: 2px;
      position: relative;
    }

    .document-header {
      padding: 30px 40px 20px;
      border-bottom: 2px solid #f8f9fa;
    }

    #post-title {
      width: 100%;
      border: none;
      outline: none;
      font-size: 28px;
      font-weight: 700;
      color: #0b1720;
      background: transparent;
      padding: 0;
      margin: 0;
      font-family: inherit;
      line-height: 1.2;
    }

    #post-title::placeholder {
      color: #adb5bd;
      font-weight: 400;
    }

    .section-select {
      margin-top: 16px;
    }

    .section-select select {
      background: white;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 8px 12px;
      color: #495057;
      font-size: 14px;
      min-width: 200px;
    }

    .section-select label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      font-weight: 600;
      color: #495057;
    }

    #editor {
      padding: 40px;
      min-height: 600px;
      font-size: 16px;
      line-height: 1.6;
      font-family: 'Times New Roman', serif;
      border: none;
      outline: none;
      background: white;
      color: #0b1720;
      width: 100%;
    }

    #editor:empty:before {
      content: "–ü–æ—á–Ω—ñ—Ç—å –ø–∏—Å–∞—Ç–∏ –≤–∞—à –ø–æ—Å—Ç —Ç—É—Ç...";
      color: #adb5bd;
      font-style: italic;
    }

    /* Status bar like Word */
    .status-bar {
      background: white;
      border-top: 1px solid #dee2e6;
      padding: 8px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #6c757d;
      min-height: 40px;
    }

    .status-left {
      display: flex;
      gap: 20px;
      align-items: center;
    }

    .char-count {
      font-weight: 500;
    }

    .char-count.warning {
      color: var(--accent-2);
      animation: pulse 1s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .status-right {
      display: flex;
      gap: 12px;
      align-items: center;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--accent), #6ea8ff);
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(56, 103, 214, 0.3);
      font-weight: 600;
      border: none;
      cursor: pointer;
      font-size: 14px;
      transition: transform var(--anim-fast), box-shadow var(--anim-fast);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(56, 103, 214, 0.4);
    }

    .btn-primary:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
      box-shadow: 0 2px 6px rgba(56, 103, 214, 0.2);
    }

    .btn-ghost {
      background: transparent;
      color: var(--muted);
      border: 1px solid #dee2e6;
      padding: 8px 16px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      transition: all var(--anim-fast);
    }

    .btn-ghost:hover {
      background: #f8f9fa;
      border-color: var(--accent);
      color: var(--accent);
    }

    /* Custom scrollbar */
    #editor::-webkit-scrollbar {
      width: 8px;
    }

    #editor::-webkit-scrollbar-track {
      background: #f1f3f4;
    }

    #editor::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 4px;
    }

    #editor::-webkit-scrollbar-thumb:hover {
      background: #a1a1a1;
    }

    @media (max-width: 768px) {
      .header {
        padding: 12px 16px;
      }
      
      .header h1 {
        font-size: 20px;
      }
      
      .editor-container {
        margin: 10px;
        border-radius: 12px;
      }
      
      .toolbar-content {
        padding: 8px 12px;
        gap: 4px;
      }
      
      .toolbar button {
        min-width: 32px;
        height: 32px;
        padding: 4px 6px;
      }
      
      .document-area {
        padding: 20px 10px;
      }
      
      .document-header {
        padding: 20px;
      }
      
      #post-title {
        font-size: 24px;
      }
      
      #editor {
        padding: 20px;
        min-height: 400px;
        font-size: 14px;
      }
      
      .status-bar {
        padding: 6px 12px;
        flex-direction: column;
        gap: 8px;
        text-align: center;
      }

      .status-left, .status-right {
        gap: 12px;
      }
    }
  </style>
</head>
<body>
  <div class="grid-overlay"></div>
  
  <div class="header">
    <h1>üìù Fiend - –†–µ–¥–∞–∫—Ç–æ—Ä –ø–æ—Å—Ç—ñ–≤</h1>
    <div class="user-info" id="user-info">
      <span>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</span>
    </div>
  </div>
  
  <div class="editor-container">
    <div class="toolbar">
      <div class="toolbar-tabs">
        <button class="toolbar-tab active">–ì–æ–ª–æ–≤–Ω–∞</button>
        <button class="toolbar-tab">–í—Å—Ç–∞–≤–∫–∞</button>
        <button class="toolbar-tab">–î–∏–∑–∞–π–Ω</button>
      </div>
      
      <div class="toolbar-content">
        <div class="toolbar-group">
          <button onclick="execCmd('bold')" title="–ñ–∏—Ä–Ω–∏–π (Ctrl+B)"><strong>–ñ</strong></button>
          <button onclick="execCmd('italic')" title="–ö—É—Ä—Å–∏–≤ (Ctrl+I)"><em>–ö</em></button>
          <button onclick="execCmd('underline')" title="–ü—ñ–¥–∫—Ä–µ—Å–ª–µ–Ω–∏–π (Ctrl+U)"><u>–ü</u></button>
          <button onclick="execCmd('strikeThrough')" title="–ó–∞–∫—Ä–µ—Å–ª–µ–Ω–∏–π"><s>–ó</s></button>
        </div>
        
        <div class="toolbar-group">
          <select onchange="execCmd('fontSize', this.value)" title="–†–æ–∑–º—ñ—Ä —à—Ä–∏—Ñ—Ç—É">
            <option value="12px">12</option>
            <option value="14px">14</option>
            <option value="16px" selected>16</option>
            <option value="18px">18</option>
            <option value="20px">20</option>
            <option value="24px">24</option>
            <option value="32px">32</option>
            <option value="48px">48</option>
          </select>
          
          <select onchange="execCmd('fontName', this.value)" title="–®—Ä–∏—Ñ—Ç">
            <option value="Times New Roman">Times New Roman</option>
            <option value="Arial">Arial</option>
            <option value="Inter">Inter</option>
            <option value="Georgia">Georgia</option>
            <option value="Helvetica">Helvetica</option>
            <option value="Courier New">Courier New</option>
          </select>
        </div>
        
        <div class="toolbar-group">
          <button onclick="execCmd('justifyLeft')" title="–ü–æ –ª—ñ–≤–æ–º—É –∫—Ä–∞—é">‚á§</button>
          <button onclick="execCmd('justifyCenter')" title="–ü–æ —Ü–µ–Ω—Ç—Ä—É">‚áî</button>
          <button onclick="execCmd('justifyRight')" title="–ü–æ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é">‚á•</button>
          <button onclick="execCmd('justifyFull')" title="–ü–æ —à–∏—Ä–∏–Ω—ñ">‚â°</button>
        </div>
        
        <div class="toolbar-group">
          <button onclick="execCmd('insertOrderedList')" title="–ù—É–º–µ—Ä–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫">1.</button>
          <button onclick="execCmd('insertUnorderedList')" title="–ú–∞—Ä–∫–æ–≤–∞–Ω–∏–π —Å–ø–∏—Å–æ–∫">‚Ä¢</button>
          <button onclick="execCmd('indent')" title="–ó–±—ñ–ª—å—à–∏—Ç–∏ –≤—ñ–¥—Å—Ç—É–ø">‚Üí</button>
          <button onclick="execCmd('outdent')" title="–ó–º–µ–Ω—à–∏—Ç–∏ –≤—ñ–¥—Å—Ç—É–ø">‚Üê</button>
        </div>
        
        <div class="toolbar-group">
          <input type="color" onchange="execCmd('foreColor', this.value)" title="–ö–æ–ª—ñ—Ä —Ç–µ–∫—Å—Ç—É" value="#0b1720">
          <input type="color" onchange="execCmd('hiliteColor', this.value)" title="–ö–æ–ª—ñ—Ä –≤–∏–¥—ñ–ª–µ–Ω–Ω—è" value="#ffff00">
        </div>
        
        <div class="toolbar-group">
          <button onclick="execCmd('undo')" title="–°–∫–∞—Å—É–≤–∞—Ç–∏ (Ctrl+Z)">‚Ü∂</button>
          <button onclick="execCmd('redo')" title="–ü–æ–≤—Ç–æ—Ä–∏—Ç–∏ (Ctrl+Y)">‚Ü∑</button>
        </div>
        
        <div class="toolbar-group">
          <button onclick="clearFormat()" title="–û—á–∏—Å—Ç–∏—Ç–∏ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è">‚úó</button>
        </div>
      </div>
    </div>
    
    <div class="document-area">
      <div class="document-container">
        <div class="document-header">
          <input 
            type="text" 
            id="post-title" 
            placeholder="–í–≤–µ–¥—ñ—Ç—å –∑–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ—Å—Ç—É..." 
            maxlength="100"
          />
          
          <div class="section-select">
            <label for="post-section">–í–∏–±–µ—Ä—ñ—Ç—å —Ä–æ–∑–¥—ñ–ª:</label>
            <select id="post-section">
              <option value="">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ä–æ–∑–¥—ñ–ª—ñ–≤...</option>
            </select>
          </div>
        </div>
        
        <div id="editor" contenteditable="true" spellcheck="true"></div>
      </div>
    </div>
    
    <div class="status-bar">
      <div class="status-left">
        <div class="char-count">
          –°–∏–º–≤–æ–ª—ñ–≤: <span id="charCount">0</span> / 2000
        </div>
        <div>
          –°–ª—ñ–≤: <span id="wordCount">0</span>
        </div>
        <div id="save-status">–ó–±–µ—Ä–µ–∂–µ–Ω–æ</div>
      </div>
      
      <div class="status-right">
        <button class="btn-ghost" onclick="saveDraft()">üíæ –ó–±–µ—Ä–µ–≥—Ç–∏ —á–µ—Ä–Ω–µ—Ç–∫—É</button>
        <button class="btn-primary" id="submit-btn" onclick="submitPost()">
          üì§ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ —Ä–æ–∑–≥–ª—è–¥
        </button>
      </div>
    </div>
  </div>

  <script>
    let editor = document.getElementById('editor');
    let titleInput = document.getElementById('post-title');
    let sectionSelect = document.getElementById('post-section');
    let charCount = document.getElementById('charCount');
    let wordCount = document.getElementById('wordCount');
    let saveStatus = document.getElementById('save-status');
    let submitBtn = document.getElementById('submit-btn');
    
    let isUpdating = false;
    let currentUser = null;
    let userToken = null;

    // Get URL parameters
    function getURLParams() {
      const params = new URLSearchParams(window.location.search);
      return {
        token: params.get('token'),
        userId: params.get('userId'),
        userName: params.get('userName')
      };
    }

    // Initialize editor
    async function initEditor() {
      const params = getURLParams();
      
      if (!params.token || !params.userId) {
        alert('–ü–æ–º–∏–ª–∫–∞: –ù–µ–≤–∞–ª—ñ–¥–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –¥–æ—Å—Ç—É–ø—É');
        window.close();
        return;
      }

      userToken = params.token;
      currentUser = {
        id: params.userId,
        name: params.userName || '–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á'
      };

      // Update user info in header
      document.getElementById('user-info').innerHTML = `
        <span>üë§ ${currentUser.name}</span>
      `;

      // Load sections
      await loadSections();
      
      // Set up auto-save
      setupAutoSave();
      
      // Update counters
      updateCounters();
      
      // Focus on title
      titleInput.focus();
    }

    // Load sections (simulate API call)
    async function loadSections() {
      // Simulate sections from your app
      const sections = [
        '–ó–∞–≥–∞–ª—å–Ω–µ –æ–±–≥–æ–≤–æ—Ä–µ–Ω–Ω—è',
        '–ù–æ–≤–∏–Ω–∏',
        '–¢–µ—Ö–Ω–æ–ª–æ–≥—ñ—ó', 
        '–°–ø–æ—Ä—Ç',
        '–ö—É–ª—å—Ç—É—Ä–∞',
        '–ü–∏—Ç–∞–Ω–Ω—è —Ç–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ'
      ];
      
      sectionSelect.innerHTML = '';
      sections.forEach(section => {
        const option = document.createElement('option');
        option.value = section;
        option.textContent = section;
        sectionSelect.appendChild(option);
      });
    }

    // Update character and word counters
    function updateCounters() {
      if (isUpdating) return;
      
      const text = editor.textContent || editor.innerText || '';
      const charLength = text.length;
      const words = text.trim() ? text.trim().split(/\s+/).length : 0;
      
      charCount.textContent = charLength;
      wordCount.textContent = words;
      
      // Warning for character limit
      charCount.parentElement.classList.toggle('warning', charLength > 1900);
      
      // Enforce 2000 character limit
      if (charLength > 2000) {
        isUpdating = true;
        const selection = window.getSelection();
        const range = selection.rangeCount > 0 ? selection.getRangeAt(0) : null;
        
        editor.textContent = text.substring(0, 2000);
        charCount.textContent = '2000';
        
        if (range) {
          const newRange = document.createRange();
          newRange.selectNodeContents(editor);
          newRange.collapse(false);
          selection.removeAllRanges();
          selection.addRange(newRange);
        }
        
        setTimeout(() => { isUpdating = false; }, 100);
      }
      
      // Update submit button state
      updateSubmitButton();
    }

    // Update submit button state
    function updateSubmitButton() {
      const hasTitle = titleInput.value.trim().length > 0;
      const hasContent = (editor.textContent || editor.innerText || '').trim().length > 0;
      const hasSection = sectionSelect.value.length > 0;
      
      submitBtn.disabled = !(hasTitle && hasContent && hasSection);
    }

    // Execute formatting commands
    function execCmd(command, value = null) {
      editor.focus();
      document.execCommand(command, false, value);
      updateToolbarState();
      updateCounters();
    }

    // Clear formatting
    function clearFormat() {
      editor.focus();
      document.execCommand('removeFormat', false, null);
      document.execCommand('unlink', false, null);
    }

    // Update toolbar button states
    function updateToolbarState() {
      const buttons = document.querySelectorAll('.toolbar button');
      buttons.forEach(button => {
        button.classList.remove('active');
      });
      
      if (document.queryCommandState('bold')) {
        document.querySelector('button[onclick="execCmd(\'bold\')"]').classList.add('active');
      }
      if (document.queryCommandState('italic')) {
        document.querySelector('button[onclick="execCmd(\'italic\')"]').classList.add('active');
      }
      if (document.queryCommandState('underline')) {
        document.querySelector('button[onclick="execCmd(\'underline\')"]').classList.add('active');
      }
      if (document.queryCommandState('strikeThrough')) {
        document.querySelector('button[onclick="execCmd(\'strikeThrough\')"]').classList.add('active');
      }
    }

    // Save draft
    function saveDraft() {
      const draftData = {
        title: titleInput.value,
        content: editor.innerHTML,
        section: sectionSelect.value,
        timestamp: Date.now()
      };
      
      localStorage.setItem(`draft_${currentUser.id}`, JSON.stringify(draftData));
      
      saveStatus.textContent = '–ß–µ—Ä–Ω–µ—Ç–∫—É –∑–±–µ—Ä–µ–∂–µ–Ω–æ';
      saveStatus.style.color = '#28a745';
      
      setTimeout(() => {
        saveStatus.textContent = '–ó–±–µ—Ä–µ–∂–µ–Ω–æ';
        saveStatus.style.color = '#6c757d';
      }, 2000);
    }

    // Load draft
    function loadDraft() {
      const saved = localStorage.getItem(`draft_${currentUser.id}`);
      if (saved) {
        const draft = JSON.parse(saved);
        titleInput.value = draft.title || '';
        editor.innerHTML = draft.content || '';
        sectionSelect.value = draft.section || '';
        updateCounters();
      }
    }

    // Setup auto-save
    function setupAutoSave() {
      let autoSaveTimer;
      
      function triggerAutoSave() {
        clearTimeout(autoSaveTimer);
        saveStatus.textContent = '–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...';
        saveStatus.style.color = '#ffc107';
        
        autoSaveTimer = setTimeout(() => {
          saveDraft();
        }, 1000);
      }
      
      titleInput.addEventListener('input', triggerAutoSave);
      editor.addEventListener('input', triggerAutoSave);
      sectionSelect.addEventListener('change', triggerAutoSave);
    }

    // Submit post
    async function submitPost() {
      const title = titleInput.value.trim();
      const content = editor.innerHTML.trim();
      const section = sectionSelect.value;
      
      if (!title || !content || !section) {
        alert('–ë—É–¥—å –ª–∞—Å–∫–∞, –∑–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è');
        return;
      }
      
      submitBtn.disabled = true;
      submitBtn.textContent = 'üì§ –í—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è...';
      
      try {
        // Simulate API call to create post
        const postData = {
          title: title,
          content: content,
          section: section,
          authorId: currentUser.id,
          authorName: currentUser.name,
          token: userToken,
          created: Date.now()
        };
        
        // Here you would make the actual API call
        // await fetch('/api/posts', { method: 'POST', body: JSON.stringify(postData) });
        
        // Simulate success
        await new Promise(resolve => setTimeout(resolve, 1500));
        
        // Clear draft
        localStorage.removeItem(`draft_${currentUser.id}`);
        
        // Show success and close
        alert(`–í–∞—à –ø–æ—Å—Ç "${title}" —É—Å–ø—ñ—à–Ω–æ –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ –Ω–∞ —Ä–æ–∑–≥–ª—è–¥!`);
        
        // Notify parent window and close
        if (window.opener) {
          window.opener.postMessage({
            type: 'POST_SUBMITTED',
            data: postData
          }, '*');
        }
        
        window.close();
        
      } catch (error) {
        console.error('Error submitting post:', error);
        alert('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ –≤—ñ–¥–ø—Ä–∞–≤—Ü—ñ –ø–æ—Å—Ç—É. –°–ø—Ä–æ–±—É–π—Ç–µ —â–µ —Ä–∞–∑.');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'üì§ –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ —Ä–æ–∑–≥–ª—è–¥';
      }
    }

    // Event listeners
    titleInput.addEventListener('input', updateCounters);
    editor.addEventListener('input', updateCounters);
    editor.addEventListener('paste', () => setTimeout(updateCounters, 10));
    editor.addEventListener('keyup', updateToolbarState);
    editor.addEventListener('mouseup', updateToolbarState);
    sectionSelect.addEventListener('change', updateSubmitButton);

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
          case 'b':
            e.preventDefault();
            execCmd('bold');
            break;
          case 'i':
            e.preventDefault();
            execCmd('italic');
            break;
          case 'u':
            e.preventDefault();
            execCmd('underline');
            break;
          case 's':
            e.preventDefault();
            saveDraft();
            break;
          case 'Enter':
            e.preventDefault();
            if (!submitBtn.disabled) {
              submitPost();
            }
            break;
        }
      }
    });

    // Initialize when page loads
    window.addEventListener('load', async function() {
      await initEditor();
      loadDraft();
    });

    // Handle window close
    window.addEventListener('beforeunload', function(e) {
      saveDraft();
    });
  </script>
</body>
</html>